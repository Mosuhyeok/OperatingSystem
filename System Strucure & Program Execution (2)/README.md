# System Strucure & Program Execution (2)

호스트는 컴퓨터 라고 할 수 있다.

인터럽트 벡터는 (os 내부)커널함수에 있음

cpu에서 인터럽트가 들어왔을때 os내부 커널함수에 있는 인터럽트 백터에서

처리 루틴의 주소를 갖고와 해당 주소에 있는 해당 인터럽트 처리 커널함수 실행

**사용자 프로그램이 I/O를 사용하는법**

사용자 프로그램은 I/O에 직접 접근하지 못하므로 OS에게 요청을 해야함

운영체제에 있는 I/O접근 함수를 요청하는것은 시스템콜

시스템 콜을 하기 위해 사용자 프로그램은 의도적으로 인터럽트를 걸어

요청함 = trap

Trap = 소프트웨어 인터럽트

 Trap의 구성요소

Exception : 프로그램이 오류를 범한것

System call : 프로그램이 커널 함수를 호출하는 것

인터럽트는 하드웨어 인터럽트 소프트웨어 인터럽트가 있다

**동기식 입출력 (synchronous I/O)**

I/O 요청 후 입출력 작업이 완료된 후에야 제어가 사용자 프로그램에 넘어감

**비동기식 입출력 (asynchronous I/O)**

I/O가 시작된 후 입출력 작업이 끝나기를 기다리지 않고 제어가 사용자프로그램에 즉시 넘어감

즉 I/O요청 해놓고 I/O요청이 필요없는 다른 코드 수행

두 경우의 모두 입출력이 끝나면 인터럽트로 알려줌

동기식 입출력 하는 경우 : 내 입력이 유효한지 확인하고 다음 코드를 진행하고 싶을때

I/O장치는 시간이 오래 걸린다

그래서 동기식 입출력을 사용 할 때 프로세스A에게 cpu를 줘봤자 더이상 할 수 있는 일이 없다. 따라서 다른 프로세스 B에게 cpu를 넘겨준다

**DMA Controller**

cpu말고 메모리를 접근 할 수 있는 장치

 cpu만 사용 할 때 키보드 입력을 할 경우 키보드 타자 한 번 치고나면 입력이 들어왔으므로 cpu에게 인터럽트를 보내고 또 다음 키보드를 치면 또 인터럽트를 보내고 

수 많은 인터럽트가 발생하니 오버헤드가 큼 → cpu가 효율적으로 동작 못함

이를 해결하기 위해 DMA Controller를 통해 키보드 입력을 특정 크기의 버퍼에 쌓아두고

버퍼가 가득차면 메모리에 값을 입력하고 이 때 cpu에게 한 번 인터럽트를 걸어서 아까 요청한 I/O작업이 다 끝나고 메모리까지 이미 올라왔다고 알려줌 

→ 인터럽트 빈도가 적어지고 cpu효율적 가능

**저장장치 계층 구조**

![Untitled](System%20Str%20bd451/Untitled.png)

cpu안에 레지스터, 캐쉬메모리

위로 갈수록 속도가 빠르고 가격이 비싸다. 따라 용량이 적다

분홍색 = 비휘발상 (전원이 나가도 내용이 사라지지 않는다)

연두색 = 휘발성 (전원이 나가면 내용이 사라진다)

사진중 Primary = cpu가 직접 접근 가능

 Secondary = cpu가 직접 접근 불가능

캐싱 : 재사용을 목적. 디스크에서 한 번 I/O를 해놓고 (시간이 오래걸림) 메모리에 올려논 뒤 다음에 쓸 때 다시 I/O요청을 하는게 아니라 메모리에 캐시 해둔걸 사용하면 빠르게 사용가능

**프로그램의 실행 (메모리 load)**

파일 시스템 예 (exe파일)이 실행이 되면 메모리에 올라오고 프로세스가 됨

정확히는 바로 물리적인 메모리 공간에 올라오는게 아니라 가상 메모리 공간

Virtual Memory에 올라온다.

프로그램을 실행시키면 그 프로세스의 주소공간이 할당되는데 독자적인 공간이 만들어진다.

이런 주소 공간은 각 프로세스가 가지고 있으며 구성공간은 아래와 같다.

![Untitled](System%20Str%20bd451/Untitled%201.png)

코드 데이터 스택으로 이루어져있으며

코드: 기계어 코드를 담고있다

데이터 : 변수, 전역변수 

스택 : 함수들이 담길 영역

이러한 독자적인 주소공간을 메모리에 올려서 실행한다.

이러한 물리적인 공간에 코드,데이터,스택 전부를 올리면 메모리가 부족해진다.

이를 해결하기 위해 지금 당장 필요한 부분만 (code)를 물리메모리에 올린다.

나중에 사용을 안할땐 메모리에서 쫓아냄.

지금 당장 필요한 부분 = 물리 메모리에 올림

지금 당장 필요하지 않은 부분 = 디스크의 Swap area라는 곳에 존재

Swap are , File system 둘다 하드디스크인데 Swap area는 전원이 꺼지면 사라짐

주소변환 계층 → 하드웨어 장치로 가상메모리 주소 → 물리메모리 주소 변환

운영체제 커널의 내용

코드: 시스템콜,인터럽트 처리코드

    자원 관리 위한 코드

편리한 서비스 제공을 위한 코드

데이터 : cpu, 메모리ㅡ disk 

       각 프로세스를 관리할 PCB (자료구조임)

 process controll block 

한 프로세스를 관리하기 위한 블록

stack : 프로세스의 커널 스택